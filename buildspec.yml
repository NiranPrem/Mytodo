version: 0.2
phases:
  install:
    runtime-versions:
      python: 3.8
    commands:
      - echo Installing dependencies...
      - pip install -r requirements.txt -t ./backend
      - aws configure set default.region us-east-1
  build:
    commands:
      - echo Building frontend...
      - mkdir -p build/frontend
      - cp -r frontend/* build/frontend/
      - echo Building backend...
      - mkdir -p build/backend
      - cp backend/lambda_function.py build/backend/
      - cd backend
      - zip -r ../build/lambda_function.zip .
  post_build:
    commands:
      - echo Updating Lambda function...
      - cd /codebuild/output/src*/src/github.com/NiranPrem/Mytodo
      - aws lambda update-function-code --function-name MyTodoLambda --zip-file fileb://build/lambda_function.zip
      - echo Build completed
artifacts:
  files:
    - build/frontend/**/*
    - build/lambda_function.zip
  base-directory: build
  discard-paths: no
